<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>PKAO.dev</title>
    <link href="css/styles.css" rel="stylesheet" />
    <style>
        #script-viewer {
            width: 100%;
            height: 400px;
            border: 1px solid #000;
            white-space: pre-wrap;
        }
        .script-action {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <ul id="script-links"></ul>
    <div id="script-viewer"></div>

    <script>
        // TODO automate generating this
        const setup_scripts = [
            'script1.bash',
            'script2.bash',
            'script3.bash',
        ];

        const scriptLinks = document.getElementById('script-links');
        const scriptViewer = document.getElementById('script-viewer');
        const baseSetupScriptURL = 'https://pkaodev.github.io/portfolio/scripts/setup/';

        setup_scripts.forEach(script => {
            const listItem = document.createElement('li');
            const viewLink = document.createElement('a');
            const downloadLink = document.createElement('a');
            const copyCommandLink = document.createElement('a');
            const copyScriptLink = document.createElement('a');

            // View script in viewer
            viewLink.href = `#`;
            viewLink.innerText = `${script}`;
            viewLink.onclick = (event) => {
                event.preventDefault();
                fetch(`${baseSetupScriptURL}${script}`, { mode: 'no-cors' })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Network response was not ok: ${response.statusText}`);
                        }
                        return response.text();
                    })
                    .then(data => {
                        scriptViewer.textContent = data;
                    })
                    .catch(error => {
                        scriptViewer.textContent = `Error loading script ${baseSetupScriptURL}${script}`;
                        console.error(error);
                    });
            };

            // Download script file
            downloadLink.href = `${baseSetupScriptURL}${script}`;
            downloadLink.download = script;
            downloadLink.innerText = `Download`;
            downloadLink.classList.add('script-action');

            // Copy command to clipboard
            copyCommandLink.href = `#`;
            const setupScriptCurlLocation = `https://pkao.dev/scripts/setup/${script}`;
            const curlCommand = `curl -s ${setupScriptCurlLocation} | bash`;
            copyCommandLink.innerText = `Copy curl command`;
            copyCommandLink.classList.add('script-action');
            copyCommandLink.onclick = (event) => {
                event.preventDefault();
                copyTextToClipboard(curlCommand);
            };

            // Copy script to clipboard
            copyScriptLink.href = `#`;
            copyScriptLink.innerText = `Copy script`;
            copyScriptLink.classList.add('script-action');
            copyScriptLink.onclick = (event) => {
                event.preventDefault();
                fetch(`${baseSetupScriptURL}${script}`, { mode: 'no-cors' })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Network response was not ok: ${response.statusText}`);
                        }
                        return response.text();
                    })
                    .then(data => {
                        copyTextToClipboard(data);
                    })
                    .catch(error => {
                        alert(`Error loading script ${baseSetupScriptURL}${script}`);
                        console.error(error);
                    });
            };

            listItem.appendChild(viewLink);
            listItem.appendChild(copyScriptLink);
            listItem.appendChild(downloadLink);
            listItem.appendChild(copyCommandLink);
            scriptLinks.appendChild(listItem);
        });

        function copyTextToClipboard(text) {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = text;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
        }
    </script>
</body>
</html>
